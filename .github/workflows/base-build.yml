name: OpenWrt Base System Build

on:
  workflow_call:
    inputs:
      chip:
        required: true
        type: string
      branch:
        required: true
        type: string

jobs:
  build-base:
    runs-on: ubuntu-22.04
    outputs:
      cache-key: ${{ steps.cache-key.outputs.key }}
      build-path: ${{ steps.cache-key.outputs.path }}
      cache-info: ${{ steps.cache-info.outputs.json }}
    steps:
      - name: ğŸ› ï¸ åˆå§‹åŒ–ç¯å¢ƒ
        run: |
          sudo apt-get update
          sudo apt-get install -y jq curl

      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” æ£€æŸ¥ç›®å½•ç»“æ„
        run: |
          echo "ğŸ“Œ å½“å‰å·¥ä½œç›®å½•: $(pwd)"
          echo "ğŸ“Œ æ ¹ç›®å½•å†…å®¹:"
          ls -la
          echo ""
          echo "ğŸ“Œ æ£€æŸ¥.githubç›®å½•:"
          ls -la .github/ 2>/dev/null || echo "âŒ .githubç›®å½•ä¸å­˜åœ¨"
          echo ""
          echo "ğŸ“Œ æŸ¥æ‰¾configsç›®å½•:"
          find . -name "configs" -type d 2>/dev/null
          echo ""
          echo "ğŸ“Œ æŸ¥æ‰¾scriptsç›®å½•:"
          find . -name "scripts" -type d 2>/dev/null
          echo ""
          echo "ğŸ“Œ æŸ¥æ‰¾baseé…ç½®æ–‡ä»¶:"
          find . -name "base_*.config" -type f 2>/dev/null
          echo ""
          echo "ğŸ“‹ è¾“å…¥å‚æ•°:"
          echo "  - chip: '${{ inputs.chip }}'"
          echo "  - branch: '${{ inputs.branch }}'"

      - name: ğŸ”‘ ç”Ÿæˆç¼“å­˜é”®
        id: cache-key
        run: |
          echo "ğŸ“‹ å¼€å§‹ç”Ÿæˆç¼“å­˜é”®..."
          echo "  - chip: '${{ inputs.chip }}'"
          echo "  - branch: '${{ inputs.branch }}'"
          
          # æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          CHIP_CONFIG_FILE="base_${{ inputs.chip }}.config"
          BRANCH_CONFIG_FILE="base_${{ inputs.branch }}.config"
          
          echo "ğŸ“‹ æŸ¥æ‰¾é…ç½®æ–‡ä»¶:"
          echo "  - èŠ¯ç‰‡é…ç½®æ–‡ä»¶: $CHIP_CONFIG_FILE"
          echo "  - åˆ†æ”¯é…ç½®æ–‡ä»¶: $BRANCH_CONFIG_FILE"
          
          # æŸ¥æ‰¾èŠ¯ç‰‡é…ç½®æ–‡ä»¶
          if [ -f "configs/$CHIP_CONFIG_FILE" ]; then
            CHIP_CONFIG="configs/$CHIP_CONFIG_FILE"
            echo "  âœ… æ‰¾åˆ°èŠ¯ç‰‡é…ç½®: $CHIP_CONFIG"
          elif [ -f ".github/configs/$CHIP_CONFIG_FILE" ]; then
            CHIP_CONFIG=".github/configs/$CHIP_CONFIG_FILE"
            echo "  âœ… æ‰¾åˆ°èŠ¯ç‰‡é…ç½®: $CHIP_CONFIG"
          else
            echo "  âŒ æ‰¾ä¸åˆ°èŠ¯ç‰‡é…ç½®æ–‡ä»¶: $CHIP_CONFIG_FILE"
            echo "ğŸ“‹ å¯ç”¨çš„èŠ¯ç‰‡é…ç½®æ–‡ä»¶:"
            find . -name "base_*.config" -type f 2>/dev/null | sed 's/^/    /'
            exit 1
          fi
          
          # æŸ¥æ‰¾åˆ†æ”¯é…ç½®æ–‡ä»¶
          if [ -f "configs/$BRANCH_CONFIG_FILE" ]; then
            BRANCH_CONFIG="configs/$BRANCH_CONFIG_FILE"
            echo "  âœ… æ‰¾åˆ°åˆ†æ”¯é…ç½®: $BRANCH_CONFIG"
          elif [ -f ".github/configs/$BRANCH_CONFIG_FILE" ]; then
            BRANCH_CONFIG=".github/configs/$BRANCH_CONFIG_FILE"
            echo "  âœ… æ‰¾åˆ°åˆ†æ”¯é…ç½®: $BRANCH_CONFIG"
          else
            echo "  âŒ æ‰¾ä¸åˆ°åˆ†æ”¯é…ç½®æ–‡ä»¶: $BRANCH_CONFIG_FILE"
            echo "ğŸ“‹ å¯ç”¨çš„åˆ†æ”¯é…ç½®æ–‡ä»¶:"
            find . -name "base_*.config" -type f 2>/dev/null | grep "base_openwrt\|base_immwrt\|base_libwrt" | sed 's/^/    /'
            exit 1
          fi
          
          # ç”ŸæˆåŸºäºé…ç½®çš„ç¼“å­˜é”®
          CHIP_HASH=$(sha256sum "$CHIP_CONFIG" | cut -d' ' -f1)
          BRANCH_HASH=$(sha256sum "$BRANCH_CONFIG" | cut -d' ' -f1)
          CACHE_KEY="base-${{ inputs.chip }}-${{ inputs.branch }}-${CHIP_HASH:0:8}-${BRANCH_HASH:0:8}"
          BUILD_PATH="build-base-${{ inputs.chip }}-${{ inputs.branch }}"
          
          echo "key=$CACHE_KEY" >> $GITHUB_OUTPUT
          echo "path=$BUILD_PATH" >> $GITHUB_OUTPUT
          echo "chip-config=$CHIP_CONFIG" >> $GITHUB_OUTPUT
          echo "branch-config=$BRANCH_CONFIG" >> $GITHUB_OUTPUT
          echo "âœ… ç¼“å­˜é”®ç”Ÿæˆå®Œæˆ: $CACHE_KEY"

      - name: ğŸ“‹ ç”Ÿæˆç¼“å­˜ä¿¡æ¯
        id: cache-info
        run: |
          # ç”ŸæˆåŒ…å«æ‰€æœ‰ç¼“å­˜ä¿¡æ¯çš„JSON
          CACHE_INFO=$(jq -n \
            --arg branch "${{ inputs.branch }}" \
            --arg key "${{ steps.cache-key.outputs.key }}" \
            --arg path "${{ steps.cache-key.outputs.path }}" \
            '{
              ($branch): {
                "cache-key": $key,
                "build-path": $path
              }
            }')
          echo "json=$CACHE_INFO" >> $GITHUB_OUTPUT
          echo "ğŸ“‹ ç¼“å­˜ä¿¡æ¯: $CACHE_INFO"

      - name: ğŸ“¦ æ¢å¤åŸºç¡€ç¯å¢ƒç¼“å­˜
        id: cache
        uses: actions/cache@v4
        with:
          path: ${{ steps.cache-key.outputs.path }}
          key: ${{ steps.cache-key.outputs.key }}
          restore-keys: |
            base-${{ inputs.chip }}-${{ inputs.branch }}-

      - name: ğŸŒ± å‡†å¤‡åŸºç¡€ç¯å¢ƒ
        if: steps.cache.outputs.cache-hit != 'true'
        run: |
          echo "ğŸ”§ å‡†å¤‡åŸºç¡€ç¼–è¯‘ç¯å¢ƒ..."
          echo "ğŸ“Œ å½“å‰å·¥ä½œç›®å½•: $(pwd)"
          echo "ğŸ“Œ èŠ¯ç‰‡: ${{ inputs.chip }}"
          echo "ğŸ“Œ åˆ†æ”¯: ${{ inputs.branch }}"
          echo "ğŸ“Œ èŠ¯ç‰‡é…ç½®æ–‡ä»¶: ${{ steps.cache-key.outputs.chip-config }}"
          echo "ğŸ“Œ åˆ†æ”¯é…ç½®æ–‡ä»¶: ${{ steps.cache-key.outputs.branch-config }}"
          
          # åˆ›å»ºæ„å»ºç›®å½•
          mkdir -p ${{ steps.cache-key.outputs.path }}
          
          # è®¾ç½®æºç ä»“åº“URLå’Œåˆ†æ”¯ - ä½¿ç”¨æ­£ç¡®çš„ä»“åº“åœ°å€
          case "${{ inputs.branch }}" in
            "openwrt")
              REPO_URL="https://github.com/laipeng668/openwrt.git"
              REPO_BRANCH="master"
              ;;
            "immwrt")
              REPO_URL="https://github.com/laipeng668/immortalwrt.git"
              REPO_BRANCH="master"
              ;;
            "libwrt")
              REPO_URL="https://github.com/laipeng668/openwrt-6.x.git"
              REPO_BRANCH="k6.12-nss"
              ;;
            *)
              echo "âŒ ä¸æ”¯æŒçš„åˆ†æ”¯: ${{ inputs.branch }}"
              echo "ğŸ’¡ æ”¯æŒçš„åˆ†æ”¯: openwrt, immwrt, libwrt"
              exit 1
              ;;
          esac
          
          echo "ğŸ”½ å…‹éš†æºç : $REPO_URL"
          echo "ğŸ“‹ ä½¿ç”¨åˆ†æ”¯: $REPO_BRANCH"
          
          # å…‹éš†æŒ‡å®šåˆ†æ”¯
          git clone --depth=1 -b $REPO_BRANCH $REPO_URL openwrt-src
          
          # è¿›å…¥æºç ç›®å½•
          cd openwrt-src
          echo "ğŸ“Œ è¿›å…¥æºç ç›®å½•: $(pwd)"
          echo "ğŸ“Œ å½“å‰åˆ†æ”¯:"
          git branch
          echo "ğŸ“Œ ä¸Šçº§ç›®å½•å†…å®¹:"
          ls -la ../
          
          # ä¿®æ­£é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºopenwrt-srcç›®å½•ï¼‰
          CHIP_CONFIG_REL="../${{ steps.cache-key.outputs.chip-config }}"
          BRANCH_CONFIG_REL="../${{ steps.cache-key.outputs.branch-config }}"
          
          echo "ğŸ“‹ ç›¸å¯¹è·¯å¾„:"
          echo "  - èŠ¯ç‰‡é…ç½®: $CHIP_CONFIG_REL"
          echo "  - åˆ†æ”¯é…ç½®: $BRANCH_CONFIG_REL"
          
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          if [ ! -f "$CHIP_CONFIG_REL" ]; then
            echo "âŒ èŠ¯ç‰‡é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $CHIP_CONFIG_REL"
            echo "ğŸ“‹ ä¸Šçº§ç›®å½•ä¸­çš„configså†…å®¹:"
            ls -la ../configs/ 2>/dev/null || echo "configsç›®å½•ä¸å­˜åœ¨"
            echo "ğŸ“‹ ä¸Šçº§ç›®å½•ä¸­çš„.github/configså†…å®¹:"
            ls -la ../.github/configs/ 2>/dev/null || echo ".github/configsç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          if [ ! -f "$BRANCH_CONFIG_REL" ]; then
            echo "âŒ åˆ†æ”¯é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $BRANCH_CONFIG_REL"
            exit 1
          fi
          
          # ä¿å­˜èŠ¯ç‰‡é…ç½®ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
          echo "ğŸ“‹ ä¿å­˜èŠ¯ç‰‡é…ç½®..."
          cp "$CHIP_CONFIG_REL" .config.chip
          echo "âœ… å·²ä¿å­˜èŠ¯ç‰‡é…ç½®"
          
          # åº”ç”¨èŠ¯ç‰‡é…ç½®
          cp "$CHIP_CONFIG_REL" .config
          echo "âœ… å·²åº”ç”¨èŠ¯ç‰‡é…ç½®"
          
          # ä¿å­˜åˆ†æ”¯é…ç½®ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
          cp "$BRANCH_CONFIG_REL" .config.branch
          echo "âœ… å·²ä¿å­˜åˆ†æ”¯é…ç½®"
          
          # è¿½åŠ åˆ†æ”¯é…ç½®
          cat "$BRANCH_CONFIG_REL" >> .config
          echo "âœ… å·²åº”ç”¨åˆ†æ”¯é…ç½®"
          
          # ç¬¬ä¸€æ¬¡ make defconfig - è¡¥å…¨åŸºç¡€é…ç½®çš„ä¾èµ–
          echo ""
          echo "ğŸ”§ ç¬¬ä¸€æ¬¡ make defconfig - è¡¥å…¨åŸºç¡€é…ç½®ä¾èµ–..."
          make defconfig
          echo "ğŸ“‹ åŸºç¡€é…ç½®é¡¹æ•°: $(grep -c '^CONFIG_' .config)"
          
          # å¤åˆ¶è„šæœ¬æ–‡ä»¶
          if [ -d "../scripts" ]; then
            SCRIPT_DIR="../scripts"
          elif [ -d "../.github/scripts" ]; then
            SCRIPT_DIR="../.github/scripts"
          else
            echo "âŒ æ‰¾ä¸åˆ°scriptsç›®å½•"
            echo "ğŸ“‹ ä¸Šçº§ç›®å½•å†…å®¹:"
            ls -la ../
            exit 1
          fi
          
          echo "ğŸ“‹ ä½¿ç”¨è„šæœ¬ç›®å½•: $SCRIPT_DIR"
          cp "$SCRIPT_DIR/diy.sh" ./
          cp "$SCRIPT_DIR/repo.sh" ./
          cp "$SCRIPT_DIR/package-check.sh" ./
          cp "$SCRIPT_DIR/compare-packages.sh" ./
          chmod +x diy.sh repo.sh package-check.sh compare-packages.sh
          
          # ç¬¬ä¸€æ¬¡LUCIè½¯ä»¶åŒ…æ£€æŸ¥
          echo ""
          echo "ğŸ” ==================== ç¬¬ä¸€æ¬¡LUCIè½¯ä»¶åŒ…æ£€æŸ¥ ===================="
          # æ‰§è¡Œæ£€æŸ¥ï¼ˆä¸è‡ªåŠ¨ä¿®å¤ï¼‰
          echo "ğŸ” æ‰§è¡Œpackage-check.shè„šæœ¬..."
          if ./package-check.sh .config "åŸºç¡€ç³»ç»Ÿ-åˆæ­¥æ£€æŸ¥" false; then
            echo "âœ… åˆæ­¥æ£€æŸ¥é€šè¿‡"
          else
            echo "âš ï¸ åˆæ­¥æ£€æŸ¥å‘ç°é—®é¢˜ï¼Œå°†åœ¨feedsæ›´æ–°åä¿®å¤"
          fi
          
          # ç¬¬ä¸€é˜¶æ®µï¼šå¯¹æ¯”èŠ¯ç‰‡é…ç½®å’Œåˆå¹¶åçš„é…ç½®
          echo ""
          echo "ğŸ” ==================== åŸºç¡€ç³»ç»Ÿé…ç½®å¯¹æ¯” ===================="
          echo "ğŸ” æ‰§è¡Œcompare-packages.shè„šæœ¬..."
          if ./compare-packages.sh .config.chip .config "åŸºç¡€ç³»ç»Ÿ"; then
            echo "âœ… é…ç½®å¯¹æ¯”å®Œæˆ"
          else
            echo "âŒ é…ç½®å¯¹æ¯”å¤±è´¥"
          fi
          
          # æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
          echo ""
          echo "ğŸ”§ æ‰§è¡Œç³»ç»Ÿåˆå§‹åŒ–..."
          ./diy.sh
          
          echo "ğŸ“¦ æ·»åŠ ç¬¬ä¸‰æ–¹è½¯ä»¶æº..."
          ./repo.sh
          
          # æ›´æ–°feeds
          echo "ğŸ”„ æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•..."
          ./scripts/feeds update -a
          ./scripts/feeds install -a
          
          # ç¬¬äºŒæ¬¡ make defconfig - è¡¥å…¨feedsæ›´æ–°åçš„é…ç½®
          echo ""
          echo "ğŸ”§ ç¬¬äºŒæ¬¡ make defconfig - è¡¥å…¨feedsæ›´æ–°åçš„é…ç½®..."
          make defconfig
          echo "ğŸ“‹ feedsæ›´æ–°åé…ç½®é¡¹æ•°: $(grep -c '^CONFIG_' .config)"
          
          # ç¬¬äºŒæ¬¡LUCIè½¯ä»¶åŒ…æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
          echo ""
          echo "ğŸ” ==================== ç¬¬äºŒæ¬¡LUCIè½¯ä»¶åŒ…æ£€æŸ¥ï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰ ===================="
          echo "ğŸ” æ‰§è¡Œpackage-check.shè„šæœ¬..."
          if ./package-check.sh .config "åŸºç¡€ç³»ç»Ÿ-æœ€ç»ˆæ£€æŸ¥" true; then
            echo "âœ… æ‰€æœ‰LUCIè½¯ä»¶åŒ…æ£€æŸ¥é€šè¿‡ï¼"
          else
            echo "âŒ LUCIè½¯ä»¶åŒ…æ£€æŸ¥å¤±è´¥ï¼ŒåŸºç¡€ç³»ç»Ÿç¼–è¯‘å°†åœæ­¢"
            exit 1
          fi
          
          # å‡†å¤‡ç¼–è¯‘ç¯å¢ƒ
          echo "ğŸ”¨ å‡†å¤‡ç¼–è¯‘å·¥å…·é“¾..."
          make -j$(nproc) IGNORE_ERRORS=1 download
          make -j$(nproc) IGNORE_ERRORS=1 tools/compile
          make -j$(nproc) IGNORE_ERRORS=1 toolchain/compile
          
          # ä¿å­˜æŠ¥å‘Šåˆ°ä¸Šçº§ç›®å½•
          echo ""
          echo "ğŸ“‹ ä¿å­˜æŠ¥å‘Šæ–‡ä»¶..."
          echo "ğŸ“‹ æ£€æŸ¥ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶..."
          ls -la *.md 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°æŠ¥å‘Šæ–‡ä»¶"
          
          # å¤åˆ¶æ‰€æœ‰.mdæ–‡ä»¶åˆ°ä¸Šçº§ç›®å½•
          for report in *.md; do
            if [ -f "$report" ]; then
              cp "$report" "../luci-packages-åŸºç¡€ç³»ç»Ÿ-${{ inputs.branch }}.md"
              echo "âœ… å·²ä¿å­˜æŠ¥å‘Š: $report"
            fi
          done
          
          # è¿”å›ä¸Šçº§ç›®å½•
          cd ..
          
          # æ‰“åŒ…åŸºç¡€ç¯å¢ƒ
          echo "ğŸ“¦ æ‰“åŒ…åŸºç¡€ç¯å¢ƒ..."
          tar -czf ${{ steps.cache-key.outputs.path }}/base.tar.gz -C openwrt-src .
          echo "âœ… åŸºç¡€ç¯å¢ƒå‡†å¤‡å®Œæˆ"

      - name: ğŸ“‹ å¤„ç†ç¼“å­˜å‘½ä¸­çš„æŠ¥å‘Š
        if: steps.cache.outputs.cache-hit == 'true'
        run: |
          echo "ğŸ“‹ ç¼“å­˜å‘½ä¸­ï¼Œä»ç¼“å­˜ä¸­æå–æŠ¥å‘Šæ–‡ä»¶..."
          
          # è§£å‹ç¼“å­˜ä¸­çš„æŠ¥å‘Šæ–‡ä»¶
          BUILD_PATH="${{ steps.cache-key.outputs.path }}"
          echo "ğŸ“Œ æ„å»ºè·¯å¾„: $BUILD_PATH"
          
          if [ -f "$BUILD_PATH/base.tar.gz" ]; then
            echo "ğŸ“¦ è§£å‹ç¼“å­˜æ–‡ä»¶..."
            mkdir -p temp-extract
            tar -xzf "$BUILD_PATH/base.tar.gz" -C temp-extract
            
            # æŸ¥æ‰¾å¹¶å¤åˆ¶æŠ¥å‘Šæ–‡ä»¶
            echo "ğŸ“‹ æŸ¥æ‰¾æŠ¥å‘Šæ–‡ä»¶..."
            find temp-extract -name "*.md" -type f -exec echo "æ‰¾åˆ°æŠ¥å‘Š: {}" \;
            
            # å¤åˆ¶æ‰€æœ‰.mdæ–‡ä»¶åˆ°å½“å‰ç›®å½•
            find temp-extract -name "*.md" -type f -exec cp {} . \;
            
            # å¤åˆ¶åˆ°ä¸Šçº§ç›®å½• - ä¿®å¤å¼•å·é—®é¢˜
            for report in åŸºç¡€ç³»ç»Ÿ-æœ€ç»ˆæ£€æŸ¥.md åŸºç¡€ç³»ç»Ÿ-åˆæ­¥æ£€æŸ¥.md åŸºç¡€ç³»ç»Ÿ.md; do
              if [ -f "temp-extract/$report" ]; then
                cp "temp-extract/$report" "../luci-packages-åŸºç¡€ç³»ç»Ÿ-${{ inputs.branch }}.md"
                echo "âœ… å·²æå–æŠ¥å‘Š: $report"
              fi
            done
            
            # æ¸…ç†ä¸´æ—¶ç›®å½•
            rm -rf temp-extract
            
            # æ£€æŸ¥æŠ¥å‘Šæ–‡ä»¶
            echo "ğŸ“‹ æ£€æŸ¥æŠ¥å‘Šæ–‡ä»¶..."
            ls -la *.md 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°æŠ¥å‘Šæ–‡ä»¶"
          else
            echo "âŒ ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°base.tar.gzæ–‡ä»¶"
            echo "ğŸ“‹ æ£€æŸ¥æ„å»ºè·¯å¾„å†…å®¹:"
            ls -la "$BUILD_PATH" 2>/dev/null || echo "æ„å»ºè·¯å¾„ä¸å­˜åœ¨"
          fi

      - name: ğŸ“¤ ä¸Šä¼ åŸºç¡€ç³»ç»ŸæŠ¥å‘Š
        if: always()
        run: |
          echo "ğŸ“‹ æ£€æŸ¥æŠ¥å‘Šæ–‡ä»¶..."
          ls -la *.md 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°æŠ¥å‘Šæ–‡ä»¶"
          
          # åˆ›å»ºä¸´æ—¶ç›®å½•ç”¨äºä¸Šä¼ 
          mkdir -p upload-reports
          
          # å¤åˆ¶æ‰€æœ‰å¯èƒ½çš„æŠ¥å‘Šæ–‡ä»¶ - ä¿®å¤æ–‡ä»¶ååŒ¹é…é—®é¢˜
          for report in luci-packages-åŸºç¡€ç³»ç»Ÿ-${{ inputs.branch }}.md åŸºç¡€ç³»ç»Ÿ-åˆæ­¥æ£€æŸ¥.md åŸºç¡€ç³»ç»Ÿ.md luci-packages-åŸºç¡€ç³»ç»Ÿ.md; do
            if [ -f "$report" ]; then
              cp "$report" upload-reports/
              echo "âœ… æ‰¾åˆ°æŠ¥å‘Šæ–‡ä»¶: $report"
            else
              echo "âš ï¸ æŠ¥å‘Šæ–‡ä»¶ä¸å­˜åœ¨: $report"
            fi
          done
          
          # æ˜¾ç¤ºä¸Šä¼ ç›®å½•å†…å®¹
          echo "ğŸ“‹ ä¸Šä¼ ç›®å½•å†…å®¹:"
          ls -la upload-reports/

      - name: ğŸ“¤ ä¸Šä¼ åŸºç¡€ç³»ç»ŸæŠ¥å‘Š
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: base-report-${{ inputs.branch }}-${{ github.run_id }}
          path: upload-reports/
          retention-days: 7
          if-no-files-found: warn
