name: Build Packages

on:
  workflow_dispatch:
    inputs:
      core-artifact:
        description: 'æ ¸å¿ƒç³»ç»ŸArtifactåç§°'
        required: true
      package:
        description: 'è½¯ä»¶åŒ…é…ç½®'
        required: true
        default: 'Pro'
        type: choice
        options:
          - Pro
          - Max
          - Ultra

jobs:
  build-packages:
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ“¦ ä¸‹è½½æ ¸å¿ƒç³»ç»Ÿ
        uses: actions/download-artifact@v4
        with:
          name: ${{ inputs.core-artifact }}
          path: core-system

      - name: ğŸ”§ ç¼–è¯‘è½¯ä»¶åŒ…
        run: |
          # æ‰§è¡Œè½¯ä»¶åŒ…ç¼–è¯‘è„šæœ¬
          chmod +x scripts/build-packages.sh
          ./scripts/build-packages.sh \
            --package "${{ inputs.package }}" \
            --core-path "core-system"

      - name: ğŸ“¤ ä¸Šä¼ å›ºä»¶
        uses: actions/upload-artifact@v4
        with:
          name: firmware-${{ inputs.package }}-${{ github.run_id }}
          path: |
            firmware/
            reports/
          retention-days: 7
