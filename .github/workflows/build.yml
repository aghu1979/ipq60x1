# .github/workflows/build.yml
name: ImmortalWrt IPQ60xx Auto Build

# è§¦å‘æ¡ä»¶ï¼šåŒ—äº¬æ—¶é—´æ¯å‘¨äº”0ç‚¹ (UTC+8 = UTCå‘¨å››16:00) æˆ–æ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: '0 16 * * 4' # UTC å‘¨å›› 16:00 = åŒ—äº¬æ—¶é—´ å‘¨äº” 00:00
  workflow_dispatch:
    inputs:
      os_version:
        description: 'é€‰æ‹©æ“ä½œç³»ç»Ÿç‰ˆæœ¬'
        required: true
        default: 'ubuntu-22.04'
        type: choice
        options:
          - ubuntu-22.04
          - ubuntu-24.04

# å…¨å±€ç¯å¢ƒå˜é‡
env:
  CHIPSET: ipq60xx
  BRANCH: immwrt
  REPO_URL: https://github.com/immortalwrt/immortalwrt
  FEEDS_CONF: feeds.conf.default
  DIY_P1_SH: scripts/diy.sh
  DIY_P2_SH: scripts/repo.sh
  UPLOAD_BIN_DIR: upload
  UPLOAD_FIRMWARE_DIR: firmware
  CONFIG_FILE: .config
  # å®šä¹‰è¾“å‡ºé¢œè‰²å’Œå›¾æ ‡
  COLOR_ERROR: '\033[1;31m' # çº¢è‰²
  COLOR_WARN: '\033[1;33m'  # é»„è‰²
  COLOR_INFO: '\033[1;36m'  # é’è‰²
  COLOR_SUCCESS: '\033[1;32m' # ç»¿è‰²
  COLOR_RESET: '\033[0m'    # é‡ç½®
  ICON_ERROR: 'âŒ'
  ICON_WARN: 'âš ï¸'
  ICON_INFO: 'â„¹ï¸'
  ICON_SUCCESS: 'âœ…'

jobs:
  build:
    name: ğŸš€ ç¼–è¯‘å›ºä»¶
    runs-on: ${{ inputs.os_version || 'ubuntu-22.04' }}
    permissions:
      contents: write
      releases: write

    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç 
      - name: â¬‡ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # æ­¥éª¤ 2: æ˜¾ç¤ºç£ç›˜ç©ºé—´
      - name: ğŸ’¾ æ˜¾ç¤ºç¼–è¯‘å‰ç£ç›˜ç©ºé—´
        run: |
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} ç¼–è¯‘å‰ç£ç›˜ç©ºé—´: ${{ env.COLOR_RESET}}"
          df -hT

      # æ­¥éª¤ 3: æ¸…ç†ç£ç›˜ç©ºé—´
      - name: ğŸ§¹ æ¸…ç†ç£ç›˜ç©ºé—´
        uses: jlumbroso/free-disk-space@main
        with:
          tool-cache: true
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          swap-storage: true

      # æ­¥éª¤ 4: æ˜¾ç¤ºæ¸…ç†åç£ç›˜ç©ºé—´
      - name: ğŸ’¾ æ˜¾ç¤ºæ¸…ç†åç£ç›˜ç©ºé—´
        run: |
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ¸…ç†åç£ç›˜ç©ºé—´: ${{ env.COLOR_RESET}}"
          df -hT

      # æ­¥éª¤ 5: ç”Ÿæˆå“ˆå¸Œæ–‡ä»¶ç”¨äºç¼“å­˜é”®
      - name: ğŸ”‘ ç”Ÿæˆå“ˆå¸Œæ–‡ä»¶
        id: generate-hashes
        run: |
          # è®¾ç½®ä¸¥æ ¼æ¨¡å¼
          set -euo pipefail
          # å®šä¹‰éœ€è¦è®¡ç®—å“ˆå¸Œçš„æ–‡ä»¶åˆ—è¡¨
          HASH_FILES=(
            "configs/base_${{ env.CHIPSET }}.config"
            "configs/base_${{ env.BRANCH }}.config"
            "${{ env.DIY_P1_SH }}"
            "${{ env.DIY_P2_SH }}"
          )
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
          for file in "${HASH_FILES[@]}"; do
            if [ ! -f "$file" ]; then
              echo -e "${{ env.COLOR_ERROR}}${{ env.ICON_ERROR}} é”™è¯¯: æ–‡ä»¶ $file ä¸å­˜åœ¨ï¼${{ env.COLOR_RESET}}"
              exit 1
            fi
          done
          # è®¡ç®—æ‰€æœ‰æ–‡ä»¶çš„ç»„åˆå“ˆå¸Œå€¼
          HASH_VALUE=$(cat "${HASH_FILES[@]}" | sha256sum | cut -d' ' -f1)
          echo "hashes-value=$HASH_VALUE" >> $GITHUB_OUTPUT
          echo -e "${{ env.COLOR_SUCCESS}}${{ env.ICON_SUCCESS}} ç¼“å­˜å“ˆå¸Œå€¼å·²ç”Ÿæˆ: $HASH_VALUE${{ env.COLOR_RESET}}"

      # æ­¥éª¤ 6: æ¢å¤/åˆ›å»ºç¼“å­˜
      - name: ğŸ“¦ æ¢å¤/åˆ›å»ºç¼“å­˜
        uses: actions/cache@v4
        with:
          path: |
            ./dl
            ./ccache
            ./toolchain
            ./build_dir
            ./staging_dir
            ./tmp
          key: ${{ env.CHIPSET }}-${{ env.BRANCH }}-${{ steps.generate-hashes.outputs.hashes-value }}
          restore-keys: |
            ${{ env.CHIPSET }}-${{ env.BRANCH }}-

      # æ­¥éª¤ 7: å®‰è£…ç¼–è¯‘ä¾èµ–
      - name: ğŸ› ï¸ å®‰è£…ç¼–è¯‘ä¾èµ–
        run: |
          sudo rm -rf /etc/apt/sources.list.d/* # ç§»é™¤å¯èƒ½å­˜åœ¨é—®é¢˜çš„æº
          sudo apt-get update
          sudo apt-get install -y $(curl -fsSL git.io/depends-ubuntu-2204)
          echo -e "${{ env.COLOR_SUCCESS}}${{ env.ICON_SUCCESS}} ä¾èµ–å®‰è£…å®Œæˆ${{ env.COLOR_RESET}}"

      # æ­¥éª¤ 8: å…‹éš†æºç å¹¶å‡†å¤‡åŸºç¡€ç¯å¢ƒ (ä»…åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶æ‰§è¡Œ)
      - name: ğŸŒ± å‡†å¤‡åŸºç¡€ç¯å¢ƒ
        run: |
          # è®¾ç½®ä¸¥æ ¼æ¨¡å¼
          set -euo pipefail
          # å¦‚æœå·¥å…·é“¾ä¸å­˜åœ¨ï¼Œåˆ™è®¤ä¸ºç¼“å­˜æœªå‘½ä¸­ï¼Œéœ€è¦å‡†å¤‡ç¯å¢ƒ
          if [ ! -d "toolchain" ]; then
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹å‡†å¤‡åŸºç¡€ç¼–è¯‘ç¯å¢ƒ...${{ env.COLOR_RESET}}"
            
            # å…‹éš†æºç 
            git clone ${{ env.REPO_URL }} immortalwrt
            cd immortalwrt
            
            # åˆå¹¶åŸºç¡€é…ç½®æ–‡ä»¶
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} åˆå¹¶åŸºç¡€é…ç½®æ–‡ä»¶...${{ env.COLOR_RESET}}"
            cat ../configs/base_${{ env.CHIPSET }}.config > .config
            cat ../configs/base_${{ env.BRANCH }}.config >> .config
            
            # è¿è¡Œè‡ªå®šä¹‰è„šæœ¬
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬ repo.sh...${{ env.COLOR_RESET}}"
            chmod +x ../${{ env.DIY_P2_SH }}
            ../${{ env.DIY_P2_SH }}
            
            # æ›´æ–°å’Œå®‰è£…è½¯ä»¶æº
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ›´æ–°å’Œå®‰è£… feeds...${{ env.COLOR_RESET}}"
            ./scripts/feeds update -a
            ./scripts/feeds install -a
            
            # æ‰©å±•é…ç½®ï¼Œè§£å†³ä¾èµ–
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} è¿è¡Œ defconfig æ‰©å±•é…ç½®...${{ env.COLOR_RESET}}"
            make defconfig
            
            # é¢„ç¼–è¯‘å·¥å…·é“¾ (è¿™æ˜¯æœ€è€—æ—¶çš„éƒ¨åˆ†ä¹‹ä¸€)
            echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} é¢„ç¼–è¯‘å·¥å…·é“¾...${{ env.COLOR_RESET}}"
            make toolchain/install -j$(nproc)
            
            echo -e "${{ env.COLOR_SUCCESS}}${{ env.ICON_SUCCESS}} åŸºç¡€ç¯å¢ƒå‡†å¤‡å®Œæˆï¼Œå·²ç¼“å­˜ã€‚${{ env.COLOR_RESET}}"
          else
            echo -e "${{ env.COLOR_SUCCESS}}${{ env.ICON_SUCCESS}} ç¼“å­˜å‘½ä¸­ï¼Œè·³è¿‡åŸºç¡€ç¯å¢ƒå‡†å¤‡ã€‚${{ env.COLOR_RESET}}"
          fi

      # æ­¥éª¤ 9: å¹¶è¡Œç¼–è¯‘ä¸åŒé…ç½®çš„å›ºä»¶
      - name: ğŸ—ï¸ å¹¶è¡Œç¼–è¯‘å›ºä»¶
        strategy:
          fail-fast: false # ä¸€ä¸ªé…ç½®å¤±è´¥ï¼Œå…¶ä»–é…ç½®ç»§ç»­ç¼–è¯‘
          matrix:
            profile: [Pro, Max, Ultra]
        run: |
          # è®¾ç½®ä¸¥æ ¼æ¨¡å¼
          set -euo pipefail
          # å®šä¹‰æ—¥å¿—æ–‡ä»¶
          LOG_FILE="build_${{ matrix.profile }}.log"
          # è¿›å…¥æºç ç›®å½•
          cd immortalwrt
          
          # --- å¼€å§‹ç¼–è¯‘é…ç½® ---
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} ---------- å¼€å§‹ç¼–è¯‘é…ç½®: ${{ matrix.profile }} ----------${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # 1. åˆå¹¶é…ç½®æ–‡ä»¶
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ­¥éª¤ 1: åˆå¹¶é…ç½®æ–‡ä»¶...${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          cp .config ../${{ env.CONFIG_FILE }}.bak # å¤‡ä»½åŸºç¡€é…ç½®
          cat ../configs/${{ matrix.profile }}.config >> .config
          
          # 2. æ£€æŸ¥ LuCI è½¯ä»¶åŒ… (æ ¸å¿ƒä¿éšœ)
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ­¥éª¤ 2: æ£€æŸ¥ LuCI è½¯ä»¶åŒ…ä¾èµ–...${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          chmod +x ../scripts/check_luci.sh
          # è°ƒç”¨æ£€æŸ¥è„šæœ¬ï¼Œå¦‚æœå¤±è´¥åˆ™ä¼šè‡ªåŠ¨é€€å‡º
          ../scripts/check_luci.sh .config | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # 3. å¼€å§‹ç¼–è¯‘
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ­¥éª¤ 3: å¼€å§‹ç¼–è¯‘å›ºä»¶...${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          make -j$(nproc) | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # 4. è¿è¡Œ DIY è„šæœ¬
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ­¥éª¤ 4: æ‰§è¡Œ DIY è„šæœ¬...${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          chmod +x ../${{ env.DIY_P1_SH }}
          ../${{ env.DIY_P1_SH }}
          
          # 5. æ”¶é›†äº§ç‰©
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} æ­¥éª¤ 5: æ”¶é›†ç¼–è¯‘äº§ç‰©...${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # æå–è®¾å¤‡å
          DEVICES=$(grep -oE 'CONFIG_TARGET_DEVICE_.*_DEVICE_(.*)=y' ../configs/base_${{ env.CHIPSET }}.config | sed -E 's/CONFIG_TARGET_DEVICE_.*_DEVICE_(.*)=y/\1/')
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} å‘ç°è®¾å¤‡: $DEVICES${{ env.COLOR_RESET}}" | tee -a "../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}"
          mkdir -p "../${{ env.UPLOAD_BIN_DIR }}/packages"
          
          for DEVICE in $DEVICES; do
            # å¤åˆ¶å¹¶é‡å‘½åå›ºä»¶
            find bin/targets/*/* -type f \( -name "*${DEVICE}*-squashfs-sysupgrade.bin" -o -name "*${DEVICE}*-squashfs-factory.bin" \) -exec cp {} "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}/" \;
            # å¤åˆ¶é…ç½®ã€æ¸…å•ç­‰ä¿¡æ¯
            cp .config "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}/${{ env.BRANCH }}-${{ env.CHIPSET }}-${DEVICE}-${{ matrix.profile }}.config"
            cp bin/targets/*/*/${DEVICE}.manifest "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}/${{ env.BRANCH }}-${{ env.CHIPSET }}-${DEVICE}-${{ matrix.profile }}.manifest"
            cp .config.buildinfo "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}/${{ env.BRANCH }}-${{ env.CHIPSET }}-${DEVICE}-${{ matrix.profile }}.config.buildinfo"
          done
          
          # å¤åˆ¶æ‰€æœ‰ ipk æ–‡ä»¶ï¼Œå…è®¸è¦†ç›–
          cp bin/packages/**/*.ipk ../${{ env.UPLOAD_BIN_DIR }}/packages/ 2>/dev/null || true
          
          # é‡å‘½åå›ºä»¶
          cd "../${{ env.UPLOAD_FIRMWARE_DIR }}/${{ matrix.profile }}"
          for f in *-squashfs-*.bin; do
            # ä½¿ç”¨ shopt å¼€å¯å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
            shopt -s nocasematch
            if [[ "$f" =~ ^(.+)-(${{ env.CHIPSET }})-(.+)-squashfs-(.+)\.bin$ ]]; then
              # é‡æ–°å‘½å: åˆ†æ”¯ç¼©å†™-è®¾å¤‡å-ç±»å‹-é…ç½®.bin
              # æ³¨æ„ï¼šè¿™é‡Œçš„æ­£åˆ™éœ€è¦æ ¹æ®å®é™…æ–‡ä»¶åè°ƒæ•´ï¼Œç¤ºä¾‹ä¸ºé€šç”¨æ ¼å¼
              # å®é™…æ–‡ä»¶åå¯èƒ½æ˜¯ qualcommax-ipq60xx-jdcloud_re-ss-01-squashfs-sysupgrade.bin
              # æˆ‘ä»¬æå–è®¾å¤‡åå’Œç±»å‹
              TYPE=${BASH_REMATCH[4]}
              # ä»æ–‡ä»¶åä¸­æå–è®¾å¤‡åï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒ trickyï¼Œå‡è®¾è®¾å¤‡ååœ¨ -squashfs ä¹‹å‰
              DEVICE_NAME=$(echo "$f" | sed -E "s/.*-${{ env.CHIPSET }}-(.+)-squashfs-.*/\1/")
              mv "$f" "${{ env.BRANCH }}-${DEVICE_NAME}-${TYPE}-${{ matrix.profile }}.bin"
            fi
            shopt -u nocasematch
          done
          
          echo -e "${{ env.COLOR_SUCCESS}}${{ env.ICON_SUCCESS}} ---------- é…ç½® ${{ matrix.profile }} ç¼–è¯‘å®Œæˆ ----------${{ env.COLOR_RESET}}" | tee -a "../../${{ env.UPLOAD_FIRMWARE_DIR }}/$LOG_FILE"
          
          # æ¢å¤åŸºç¡€é…ç½®ï¼Œä¾›ä¸‹ä¸€ä¸ª matrix ä½¿ç”¨
          cd ../../immortalwrt
          cp ../${{ env.CONFIG_FILE }}.bak .config

      # æ­¥éª¤ 10: æ‰“åŒ…å¹¶ä¸Šä¼ äº§ç‰©
      - name: ğŸ“¦ æ‰“åŒ…å¹¶ä¸Šä¼ äº§ç‰©
        if: always() # å³ä½¿å‰é¢æœ‰å¤±è´¥ï¼Œä¹Ÿå°è¯•ä¸Šä¼ å·²ç”Ÿæˆçš„äº§ç‰©
        run: |
          # è®¾ç½®ä¸¥æ ¼æ¨¡å¼
          set -euo pipefail
          # æ‰“åŒ…é…ç½®æ–‡ä»¶
          cd ${{ env.UPLOAD_FIRMWARE_DIR }}
          tar -czvf ../${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-config.tar.gz ./*/*.config ./*/*.config.buildinfo ./*/*.manifest
          # æ‰“åŒ…æ‰€æœ‰ ipk æ–‡ä»¶
          cd ../${{ env.UPLOAD_BIN_DIR }}
          tar -czvf ${{ env.CHIPSET }}-app.tar.gz packages/
          # æ‰“åŒ…æ—¥å¿—
          cd ../${{ env.UPLOAD_FIRMWARE_DIR }}
          tar -czvf ../${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-log.tar.gz *.log
          
          # ä¸Šä¼  Artifact
          cd ../${{ env.UPLOAD_BIN_DIR }}
          echo -e "${{ env.COLOR_INFO}}${{ env.ICON_INFO}} ä¸Šä¼ ç¼–è¯‘äº§ç‰©åˆ° GitHub Artifacts...${{ env.COLOR_RESET}}"
          # ä½¿ç”¨ zip å‘½ä»¤æ‰“åŒ…ï¼Œå› ä¸º artifact ä¸Šä¼ å¯¹å•ä¸ªæ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œä½†zipå¯ä»¥å‹ç¼©
          zip -r firmware.zip ${{ env.UPLOAD_FIRMWARE_DIR }}/
          zip -r ${{ env.CHIPSET }}-config.zip ${{ env.CHIPSET }}-config.tar.gz
          zip -r ${{ env.CHIPSET }}-app.zip ${{ env.CHIPSET }}-app.tar.gz
          zip -r ${{ env.CHIPSET }}-log.zip ${{ env.CHIPSET }}-log.tar.gz

      - name: ğŸ“¤ ä¸Šä¼ å›ºä»¶ Artifact
        uses: actions/upload-artifact@v4
        with:
          name: firmware_all
          path: ${{ env.UPLOAD_BIN_DIR }}/firmware.zip
          retention-days: 7

      - name: ğŸ“¤ ä¸Šä¼ é…ç½® Artifact
        uses: actions/upload-artifact@v4
        with:
          name: config_all
          path: ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-config.zip
          retention-days: 7

      - name: ğŸ“¤ ä¸Šä¼ è½¯ä»¶åŒ… Artifact
        uses: actions/upload-artifact@v4
        with:
          name: packages_all
          path: ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-app.zip
          retention-days: 7

      - name: ğŸ“¤ ä¸Šä¼ æ—¥å¿— Artifact
        uses: actions/upload-artifact@v4
        with:
          name: logs_all
          path: ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-log.zip
          retention-days: 7

      # æ­¥éª¤ 11: å‘å¸ƒåˆ° Release
      - name: ğŸš€ å‘å¸ƒåˆ° GitHub Release
        if: success() # åªæœ‰æ‰€æœ‰ç¼–è¯‘ä»»åŠ¡éƒ½æˆåŠŸæ‰å‘å¸ƒ
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.CHIPSET }}-${{ github.run_number }}-${{ github.sha }}
          body: |
            ## ğŸ‰ ImmortalWrt ${{ env.CHIPSET }} å›ºä»¶å‘å¸ƒ
            - **ä½œè€…**: Mary
            - **å‘å¸ƒæ—¶é—´**: ${{ github.event.head_commit.timestamp }}
            - **æºç åˆ†æ”¯**: ${{ env.BRANCH }}
            - **ç¼–è¯‘é…ç½®**: Pro, Max, Ultra
            - **å†…æ ¸ç‰ˆæœ¬**: $(cd immortalwrt && make kernelconfig | grep CONFIG_KERNEL -m 1 | cut -d'=' -f2)
            
            ---
            
            ## ğŸ“‹ å›ºä»¶ä¿¡æ¯
            - **é»˜è®¤ç®¡ç†åœ°å€**: 192.168.111.1
            - **é»˜è®¤ç”¨æˆ·**: root
            - **é»˜è®¤å¯†ç **: æ—  (ç›´æ¥å›è½¦)
            - **é»˜è®¤WIFIå¯†ç **: 12345678
            
            ---
            
            ## ğŸ“¦ åŒ…å«çš„ LuCI åº”ç”¨åˆ—è¡¨
            $(cd ${{ env.UPLOAD_BIN_DIR }} && tar -tzf ${{ env.CHIPSET }}-app.tar.gz | grep luci-app | sed 's/packages\///' | sort | uniq)
            
            ---
            
            ## â¬‡ï¸ ä¸‹è½½è¯´æ˜
            è¯·æ ¹æ®æ‚¨çš„è®¾å¤‡å‹å·å’Œæ‰€éœ€é…ç½®ä¸‹è½½å¯¹åº”çš„å›ºä»¶æ–‡ä»¶ã€‚
            - `immwrt-<è®¾å¤‡å>-<factory/sysupgrade>-<Pro/Max/Ultra>.bin` æ˜¯å›ºä»¶æ–‡ä»¶ã€‚
            - `${{ env.CHIPSET }}-config.tar.gz` åŒ…å«æ‰€æœ‰é…ç½®ã€æ¸…å•å’Œæ„å»ºä¿¡æ¯ã€‚
            - `${{ env.CHIPSET }}-app.tar.gz` åŒ…å«æ‰€æœ‰ç¼–è¯‘å‡ºçš„è½¯ä»¶åŒ…ã€‚
            - `${{ env.CHIPSET }}-log.tar.gz` åŒ…å«æœ¬æ¬¡ç¼–è¯‘çš„è¯¦ç»†æ—¥å¿—ã€‚

          files: |
            ${{ env.UPLOAD_BIN_DIR }}/firmware.zip
            ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-config.zip
            ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-app.zip
            ${{ env.UPLOAD_BIN_DIR }}/${{ env.CHIPSET }}-log.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
